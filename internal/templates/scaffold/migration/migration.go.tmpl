
// --- BEGIN MIGRATION V{{.Version}} ---

// Add to migrations slice:
// {
//     Version: {{.Version}},
//     Name:    "{{.NameSnake}}",
//     Up:      migrationV{{.Version}},
// },

func migrationV{{.Version}}(db *sql.DB) error {
{{- if .Entity}}
	_, err := db.Exec(`
		CREATE TABLE {{.Entity.NamePlural}} (
			id TEXT PRIMARY KEY,
			mission_id TEXT NOT NULL,
{{- range .Entity.Fields}}
			{{.NameSnake}} {{.SQLType}},
{{- end}}
{{- if .Entity.HasStatus}}
			status TEXT NOT NULL CHECK(status IN ({{statusList .Entity.StatusValues}})) DEFAULT '{{index .Entity.StatusValues 0}}',
{{- end}}
			pinned INTEGER DEFAULT 0,
			created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
			updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
			FOREIGN KEY (mission_id) REFERENCES missions(id)
		)
	`)
	if err != nil {
		return fmt.Errorf("failed to create {{.Entity.NamePlural}} table: %w", err)
	}

	// Create index for mission lookup
	_, err = db.Exec("CREATE INDEX IF NOT EXISTS idx_{{.Entity.NamePlural}}_mission ON {{.Entity.NamePlural}}(mission_id)")
	if err != nil {
		return fmt.Errorf("failed to create {{.Entity.NamePlural}} mission index: %w", err)
	}
{{- else}}
	// TODO: Add your migration SQL here
	// Example:
	// _, err := db.Exec(`ALTER TABLE some_table ADD COLUMN new_column TEXT`)
	// if err != nil {
	//     return fmt.Errorf("failed to add column: %w", err)
	// }
	_ = db // Remove this line after adding migration logic
{{- end}}

	return nil
}

// --- END MIGRATION V{{.Version}} ---

