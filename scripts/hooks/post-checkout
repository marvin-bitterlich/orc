#!/bin/bash

# =============================================================================
# Post-checkout hook - Reminder for AI agents
# Shows breadcrumbs about schema state after branch switches
# =============================================================================

# Args: $1=prev HEAD, $2=new HEAD, $3=1 if branch checkout (0 if file checkout)
BRANCH_CHECKOUT=$3

# Only run on branch checkouts, not file checkouts
if [[ "$BRANCH_CHECKOUT" != "1" ]]; then
    exit 0
fi

BRANCH=$(git rev-parse --abbrev-ref HEAD)
echo ""
echo "üìç Switched to branch: $BRANCH"

# Check if schema might be out of sync
if command -v atlas &>/dev/null; then
    if atlas schema diff --env local 2>/dev/null | grep -q .; then
        echo "‚ö†Ô∏è  Schema may differ from schema.sql"
        echo "   Run: make schema-diff   (preview)"
        echo "   Run: make schema-apply  (apply changes)"
    fi
else
    echo "üí° Atlas not installed for schema management"
    echo "   Install: brew install ariga/tap/atlas"
fi

# Check for workbench-local database
if [[ -f ".orc/workbench.db" ]]; then
    echo "üì¶ ORC Workbench DB: .orc/workbench.db"
    echo "   ‚Ä¢ orc-dev ‚Üí uses local DB"
    echo "   ‚Ä¢ orc     ‚Üí uses production DB"
fi
echo ""
